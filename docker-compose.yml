services:
  # MySQL
  db:
    container_name: mysql-db
    image: mysql:8
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 'rootroot'
      MYSQL_DATABASE: 'mediconnect'
      MYSQL_ROOT_HOST: '%'
      MYSQL_USER: testuser
    # ports:
    #   - "3306:3306"
    volumes:
      - db-data:/var/lib/mysql

  # Angular Frontend
  frontend:
    container_name: frontend
    restart: always
    build: ./Frontend/
    ports:
      - "8000:80"
    depends_on:
      - backend
      - webrtc_server

  # Node.js Backend
  backend:
    container_name: backend
    restart: always
    build: ./Backend/
    ports:
      - "3000:3000"
    environment:
      DB_HOST: db
      DB_USER: root
      DB_PWD: rootroot
      MYSQL_DB: mediconnect

      LOGGING_HOST: logstash
      LOGGING_PORT: 5000
    depends_on:
      - db
      # - logstash

  # WebRTC Signaling Server
  webrtc_server:
    container_name: webrtc_server
    restart: always
    build: ./WebRTC_Signaling_Server/
    ports:
      - "4440:4440"
    # depends_on:
    #   - logstash
    environment:
      LOGGING_HOST: logstash
      LOGGING_PORT: 5000

  # # Elasticsearch
  # elasticsearch:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4
  #   container_name: elasticsearch
  #   environment:
  #     - discovery.type=single-node
  #     - xpack.security.enabled=false
  #     - bootstrap.memory_lock=true
  #     - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
  #   ulimits:
  #     memlock:
  #       soft: -1
  #       hard: -1
  #   ports:
  #     - "9200:9200"
  #   volumes:
  #     - es-data:/usr/share/elasticsearch/data

  # # Logstash
  # logstash:
  #   image: docker.elastic.co/logstash/logstash:8.13.4
  #   container_name: logstash
  #   ports:
  #     - "5000:5000"       # TCP input
  #     - "9600:9600"       # Monitoring
  #   volumes:
  #     - ./ELK/pipeline:/usr/share/logstash/pipeline
  #   depends_on:
  #     - elasticsearch

  # # Kibana
  # kibana:
  #   image: docker.elastic.co/kibana/kibana:8.13.4
  #   container_name: kibana
  #   ports:
  #     - "5601:5601"
  #   environment:
  #     - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
  #   depends_on:
  #     - elasticsearch

volumes:
  db-data:
  # es-data: